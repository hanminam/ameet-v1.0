<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMEET ê´€ë¦¬ì í˜ì´ì§€ ì„¤ê³„ì•ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f8fafc;
        }
        .sidebar-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            color: #4b5563;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .sidebar-link:hover {
            background-color: #e5e7eb;
            color: #111827;
        }
        .sidebar-link.active {
            background-color: #2563eb;
            color: white;
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            padding: 1.5rem;
        }
        .table th, .table td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
            vertical-align: middle;
        }
        .table tbody tr:hover {
            background-color: #f9fafb;
        }
        /* Toggle Switch CSS */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #2563eb;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #2563eb;
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="flex h-screen bg-gray-100">
        <!-- Sidebar -->
        <aside class="w-64 bg-white shadow-md flex-shrink-0">
            <div class="p-4 border-b">
                <h1 class="text-2xl font-bold text-blue-600">AMEET Admin</h1>
            </div>
            <nav class="p-4 space-y-2">
                <a href="#" class="sidebar-link" onclick="showPage('dashboard')">
                    <span class="mr-3">ğŸ“Š</span> ëŒ€ì‹œë³´ë“œ
                </a>
                <a href="#" class="sidebar-link" onclick="showPage('users')">
                    <span class="mr-3">ğŸ‘¥</span> ê³„ì • ê´€ë¦¬
                </a>
                <a href="#" class="sidebar-link" onclick="showPage('monitoring')">
                    <span class="mr-3">ğŸ”</span> í† ë¡  ëª¨ë‹ˆí„°ë§
                </a>
                <a href="#" class="sidebar-link active" onclick="showPage('tokens')">
                    <span class="mr-3">ğŸ’°</span> í† í° ì‚¬ìš©ëŸ‰ ë¶„ì„
                </a>
                <a href="#" class="sidebar-link" onclick="showPage('agents')">
                    <span class="mr-3">ğŸ¤–</span> ì—ì´ì „íŠ¸ ì„¤ì •
                </a>
            </nav>
            <div class="absolute bottom-0 w-64 p-4 border-t bg-white">
                <div class="flex items-center">
                    <div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center font-bold">A</div>
                    <div class="ml-3">
                        <p class="font-semibold">ê´€ë¦¬ì</p>
                        <a href="#" class="text-sm text-red-500">ë¡œê·¸ì•„ì›ƒ</a>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-6 md:p-8 overflow-y-auto">
            
            <!-- Page: Dashboard -->
            <div id="dashboard" class="page">
                <h2 class="text-3xl font-bold mb-6">ëŒ€ì‹œë³´ë“œ</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="card text-center">
                        <p class="text-gray-500 text-sm">ì´ ì‚¬ìš©ì</p>
                        <p class="text-4xl font-bold mt-2">128</p>
                    </div>
                    <div class="card text-center">
                        <p class="text-gray-500 text-sm">ì˜¤ëŠ˜ ì§„í–‰ëœ í† ë¡ </p>
                        <p class="text-4xl font-bold mt-2">32</p>
                    </div>
                    <div class="card text-center">
                        <p class="text-gray-500 text-sm">ì´ ì—ì´ì „íŠ¸ ìˆ˜</p>
                        <p class="text-4xl font-bold mt-2">35</p>
                    </div>
                    <div class="card text-center">
                        <p class="text-gray-500 text-sm">ì˜ˆìƒ ì›”ê°„ ë¹„ìš©</p>
                        <p class="text-4xl font-bold mt-2">$256.70</p>
                    </div>
                </div>
                <div class="card">
                    <h3 class="font-bold mb-4">ì£¼ê°„ í† ë¡  ì§„í–‰ëŸ‰</h3>
                    <div class="h-80"><canvas id="weeklyDiscussionsChart"></canvas></div>
                </div>
            </div>

            <!-- Page: User Management -->
            <div id="users" class="page">
                 <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold">ê³„ì • ê´€ë¦¬</h2>
                    <button class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ï¼‹ ìƒˆ ê³„ì • ì¶”ê°€</button>
                </div>
                <div class="card overflow-x-auto">
                    <table class="w-full table">
                        <thead>
                            <tr class="bg-gray-50">
                                <th>ID</th>
                                <th>ì´ë©”ì¼</th>
                                <th>ê°€ì…ì¼</th>
                                <th>ë§ˆì§€ë§‰ ì ‘ì†</th>
                                <th>ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>128</td>
                                <td>user1@example.com</td>
                                <td>2025-08-15</td>
                                <td>2025-08-18</td>
                                <td><button class="text-blue-500">ìˆ˜ì •</button> <button class="text-red-500 ml-2">ì‚­ì œ</button></td>
                            </tr>
                            <tr>
                                <td>127</td>
                                <td>user2@example.com</td>
                                <td>2025-08-14</td>
                                <td>2025-08-17</td>
                                <td><button class="text-blue-500">ìˆ˜ì •</button> <button class="text-red-500 ml-2">ì‚­ì œ</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Page: Discussion Monitoring -->
            <div id="monitoring" class="page">
                <h2 class="text-3xl font-bold mb-6">í† ë¡  ì´ë ¥ ëª¨ë‹ˆí„°ë§</h2>
                <div class="card overflow-x-auto">
                    <table class="w-full table">
                        <thead>
                            <tr class="bg-gray-50">
                                <th>í† ë¡  ID</th>
                                <th>ì‚¬ìš©ì ì´ë©”ì¼</th>
                                <th>ì£¼ì œ</th>
                                <th>ì‹œì‘ ì‹œê°„</th>
                                <th>ìƒíƒœ</th>
                                <th>ìƒì„¸</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>sess_abc123</td>
                                <td>user1@example.com</td>
                                <td>í…ŒìŠ¬ë¼ ì£¼ê°€ ì „ë§...</td>
                                <td>2025-08-18 14:30</td>
                                <td><span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded-full">ì™„ë£Œ</span></td>
                                <td><a href="#" class="text-blue-500">ë‚´ìš©/ë³´ê³ ì„œ ë³´ê¸°</a></td>
                            </tr>
                            <tr>
                                <td>sess_def456</td>
                                <td>user2@example.com</td>
                                <td>ëŒ€í•œë¯¼êµ­ ìˆ˜ë„ ì´ì „...</td>
                                <td>2025-08-18 14:15</td>
                                <td><span class="bg-yellow-100 text-yellow-800 text-xs font-medium px-2.5 py-0.5 rounded-full">ì§„í–‰ì¤‘</span></td>
                                <td><a href="#" class="text-blue-500">ì‹¤ì‹œê°„ ë³´ê¸°</a></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Page: Token Usage Analysis (List View) -->
            <div id="tokens" class="page active">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold">í† í° ì‚¬ìš©ëŸ‰ ìƒì„¸ ë¶„ì„</h2>
                    <a href="#" target="_blank" class="bg-gray-800 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-900">LangSmithì—ì„œ ë³´ê¸° â†—</a>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="card text-center">
                        <p class="text-gray-500 text-sm">ì´ ì‚¬ìš© ë¹„ìš© (ì´ë²ˆ ë‹¬)</p>
                        <p class="text-3xl font-bold mt-2">$182.50</p>
                    </div>
                    <div class="card text-center">
                        <p class="text-gray-500 text-sm">ì´ í† ë¡  ìˆ˜</p>
                        <p class="text-3xl font-bold mt-2">482</p>
                    </div>
                    <div class="card text-center">
                        <p class="text-gray-500 text-sm">í† ë¡  ë‹¹ í‰ê·  ë¹„ìš©</p>
                        <p class="text-3xl font-bold mt-2">$0.378</p>
                    </div>
                </div>

                <div class="card mb-8">
                    <h3 class="font-bold mb-4">í† ë¡ ë³„ ë¹„ìš© ë¶„ì„</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full table">
                            <thead>
                                <tr class="bg-gray-50">
                                    <th>í† ë¡  ID</th>
                                    <th>ì‚¬ìš©ì</th>
                                    <th>ì´ í† í°</th>
                                    <th>ì˜ˆìƒ ë¹„ìš©</th>
                                    <th>ëª¨ë¸ë³„ ì‚¬ìš©ëŸ‰</th>
                                    <th>ìƒì„¸</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>sess_abc123</td>
                                    <td>user1@...</td>
                                    <td>15,820</td>
                                    <td>$0.45</td>
                                    <td>
                                        <div class="text-xs">
                                            <p><strong>GPT-4o:</strong> 8,120</p>
                                            <p><strong>Gemini:</strong> 5,200</p>
                                            <p><strong>Claude:</strong> 2,500</p>
                                        </div>
                                    </td>
                                    <td><a href="#" class="text-blue-500 font-semibold" onclick="showDetailPage('sess_abc123')">ë¶„ì„</a></td>
                                </tr>
                                 <tr>
                                    <td>sess_ghi789</td>
                                    <td>user3@...</td>
                                    <td>8,550</td>
                                    <td>$0.21</td>
                                    <td>
                                        <div class="text-xs">
                                            <p><strong>GPT-4o:</strong> 3,500</p>
                                            <p><strong>Gemini:</strong> 5,050</p>
                                        </div>
                                    </td>
                                    <td><a href="#" class="text-blue-500 font-semibold" onclick="showDetailPage('sess_ghi789')">ë¶„ì„</a></td>
                                </tr>
                                <tr>
                                    <td>sess_jkl012</td>
                                    <td>user1@...</td>
                                    <td>22,100</td>
                                    <td>$0.88</td>
                                    <td>
                                        <div class="text-xs">
                                            <p><strong>Claude:</strong> 22,100</p>
                                        </div>
                                    </td>
                                    <td><a href="#" class="text-blue-500 font-semibold" onclick="showDetailPage('sess_jkl012')">ë¶„ì„</a></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="card">
                        <h3 class="font-bold mb-4">ëª¨ë¸ë³„ ì´ ë¹„ìš© ë¶„ì„</h3>
                        <div class="h-80"><canvas id="costByModelChart"></canvas></div>
                    </div>
                    <div class="card">
                        <h3 class="font-bold mb-4">ì¼ë³„ í† ë¡  ë¹„ìš© ì¶”ì´</h3>
                        <div class="h-80"><canvas id="dailyCostChart"></canvas></div>
                    </div>
                </div>
            </div>
            
            <!-- [NEW] Page: Token Usage Detail View -->
            <div id="token-detail" class="page">
                <div class="mb-6">
                    <button class="text-blue-600 font-semibold hover:underline" onclick="showPage('tokens')">â† í† í° ë¶„ì„ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
                </div>
                <h2 class="text-3xl font-bold mb-2">í† ë¡  ìƒì„¸ ë¶„ì„: <span id="detail-session-id" class="text-blue-600"></span></h2>
                <p class="text-gray-500 mb-6" id="detail-topic"></p>
                
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="card text-center"><p class="text-gray-500 text-sm">ì´ ë¹„ìš©</p><p id="detail-total-cost" class="text-3xl font-bold mt-2"></p></div>
                    <div class="card text-center"><p class="text-gray-500 text-sm">ì´ í† í°</p><p id="detail-total-tokens" class="text-3xl font-bold mt-2"></p></div>
                    <div class="card text-center"><p class="text-gray-500 text-sm">ì‚¬ìš©ì</p><p id="detail-user" class="text-xl font-bold mt-2"></p></div>
                    <div class="card text-center"><p class="text-gray-500 text-sm">í† ë¡  ì‹œê°„</p><p id="detail-duration" class="text-3xl font-bold mt-2"></p></div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2 card">
                        <h3 class="font-bold mb-4">ì—ì´ì „íŠ¸ë³„ ë¹„ìš© ìƒì„¸ ë‚´ì—­</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full table">
                                <thead>
                                    <tr class="bg-gray-50">
                                        <th>ìˆœì„œ</th>
                                        <th>ì—ì´ì „íŠ¸</th>
                                        <th>ëª¨ë¸</th>
                                        <th>ì…ë ¥ í† í°</th>
                                        <th>ì¶œë ¥ í† í°</th>
                                        <th>ë¹„ìš©</th>
                                    </tr>
                                </thead>
                                <tbody id="detail-turn-table">
                                    <!-- JS will populate this -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card">
                        <h3 class="font-bold mb-4">ì—ì´ì „íŠ¸ë³„ ë¹„ìš© ê¸°ì—¬ë„</h3>
                        <div class="h-80"><canvas id="costByAgentChart"></canvas></div>
                    </div>
                </div>
            </div>

            <!-- Page: Agent Settings -->
            <div id="agents" class="page active">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold">ì—ì´ì „íŠ¸ ì„¤ì •</h2>
                    <button class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700" onclick="toggleModal('agent-edit-modal')">ï¼‹ ìƒˆ ì—ì´ì „íŠ¸ ì¶”ê°€</button>
                </div>
                 <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                    <!-- [ì œì•ˆ 4 ë°˜ì˜] í™œì„±í™”/ë¹„í™œì„±í™” í† ê¸€ ì¶”ê°€ -->
                    <div class="card text-center relative">
                        <div class="absolute top-4 right-4 flex items-center gap-2">
                            <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                                <input type="checkbox" name="toggle" id="toggle1" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer" checked/>
                                <label for="toggle1" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                            </div>
                            <button onclick="toggleModal('agent-edit-modal')">âš™ï¸</button>
                        </div>
                        <p class="text-5xl pt-4">ğŸ’¹</p>
                        <h3 class="font-bold mt-2">ì¬ë¬´ ë¶„ì„ê°€</h3>
                        <p class="text-xs text-gray-500 mt-1">gemini-1.5-pro</p>
                    </div>
                    <div class="card text-center relative opacity-50 bg-gray-50">
                         <div class="absolute top-4 right-4 flex items-center gap-2">
                            <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                                <input type="checkbox" name="toggle" id="toggle2" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                                <label for="toggle2" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                            </div>
                            <button onclick="toggleModal('agent-edit-modal')">âš™ï¸</button>
                        </div>
                        <p class="text-5xl pt-4">ğŸ¤”</p>
                        <h3 class="font-bold mt-2">ë¹„íŒì  ê´€ì  (ë¹„í™œì„±)</h3>
                        <p class="text-xs text-gray-500 mt-1">gpt-4o</p>
                    </div>
                     <div class="card text-center relative">
                        <div class="absolute top-4 right-4 flex items-center gap-2">
                            <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                                <input type="checkbox" name="toggle" id="toggle3" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer" checked/>
                                <label for="toggle3" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                            </div>
                            <button onclick="toggleModal('agent-edit-modal')">âš™ï¸</button>
                        </div>
                        <p class="text-5xl pt-4">ğŸŒ</p>
                        <h3 class="font-bold mt-2">ê±°ì‹œê²½ì œ ì „ë¬¸ê°€</h3>
                        <p class="text-xs text-gray-500 mt-1">claude-3.5-sonnet</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- [NEW] ì—ì´ì „íŠ¸ ìˆ˜ì •/ì¶”ê°€ Modal -->
    <div id="agent-edit-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden opacity-0 z-50">
        <div class="card w-full max-w-2xl max-h-[90vh] flex flex-col p-0">
            <div class="p-4 border-b flex justify-between items-center">
                <h2 class="text-xl font-bold text-blue-600">ì—ì´ì „íŠ¸ ì„¤ì • ìˆ˜ì •</h2>
                <button class="text-2xl font-bold" onclick="toggleModal('agent-edit-modal')">&times;</button>
            </div>
            <div class="p-6 space-y-4 overflow-y-auto">
                <div>
                    <label class="font-semibold">ì—ì´ì „íŠ¸ ì´ë¦„</label>
                    <input type="text" value="ì¬ë¬´ ë¶„ì„ê°€" class="w-full mt-1 p-2 border-gray-300 border rounded-lg">
                </div>
                <div>
                    <label class="font-semibold">ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸</label>
                    <textarea rows="8" class="w-full mt-1 p-2 border-gray-300 border rounded-lg">You are a professional Financial Analyst...</textarea>
                </div>
                <div>
                    <label class="font-semibold">LLM ëª¨ë¸</label>
                    <select class="w-full mt-1 p-2 border-gray-300 border rounded-lg">
                        <option>gpt-4o</option>
                        <option selected>gemini-1.5-pro</option>
                        <option>claude-3.5-sonnet</option>
                    </select>
                </div>
                <!-- [ì œì•ˆ 4 ë°˜ì˜] ë³€ê²½ ì´ë ¥ í™•ì¸ ë²„íŠ¼ -->
                <button class="text-sm text-blue-600 hover:underline" onclick="toggleModal('history-modal')">í”„ë¡¬í”„íŠ¸ ë³€ê²½ ì´ë ¥ ë³´ê¸°</button>
            </div>
            <div class="p-4 border-t bg-gray-50 flex justify-end items-center gap-4">
                <button class="text-red-600 font-semibold hover:text-red-800">ì‚­ì œ</button>
                <button class="bg-gray-200 text-gray-800 font-bold py-2 px-6 rounded-lg hover:bg-gray-300" onclick="toggleModal('agent-edit-modal')">ì·¨ì†Œ</button>
                <button class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700">ì €ì¥</button>
            </div>
        </div>
    </div>

    <!-- [NEW] í”„ë¡¬í”„íŠ¸ ë³€ê²½ ì´ë ¥ Modal -->
    <div id="history-modal" class="modal fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 hidden opacity-0 z-50">
        <div class="card w-full max-w-lg max-h-[70vh] flex flex-col p-0">
            <div class="p-4 border-b flex justify-between items-center">
                <h2 class="text-xl font-bold text-blue-600">í”„ë¡¬í”„íŠ¸ ë³€ê²½ ì´ë ¥</h2>
                <button class="text-2xl font-bold" onclick="toggleModal('history-modal')">&times;</button>
            </div>
            <div class="p-6 space-y-4 overflow-y-auto">
                <div class="border-b pb-2">
                    <p class="font-semibold">ë²„ì „ 1.2 <span class="text-sm text-gray-500 font-normal">(2025-08-20 by admin)</span></p>
                    <p class="text-sm text-gray-600 mt-1">"You are a professional Financial Analyst. Your role is to provide insightful financial analysis..."</p>
                </div>
                 <div class="border-b pb-2">
                    <p class="font-semibold">ë²„ì „ 1.1 <span class="text-sm text-gray-500 font-normal">(2025-08-15 by admin)</span></p>
                    <p class="text-sm text-gray-600 mt-1">"You are a Financial Analyst..."</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mock Data for Detail Page
        const detailData = {
            "sess_abc123": {
                topic: "í…ŒìŠ¬ë¼ ì£¼ê°€ ì „ë§ì— ëŒ€í•œ ì‹¬ì¸µ ë¶„ì„",
                total_cost: 0.45,
                total_tokens: 15820,
                user: "user1@example.com",
                duration: "12ë¶„ 30ì´ˆ",
                turns: [
                    { turn: 1, agent: "SNS íŠ¸ë Œë“œ ë¶„ì„ê°€", model: "Gemini 1.5", input: 500, output: 1200, cost: 0.05 },
                    { turn: 2, agent: "ì¬ë¬´ ë¶„ì„ê°€", model: "GPT-4o", input: 1500, output: 800, cost: 0.10 },
                    { turn: 3, agent: "ë¹„íŒì  ê´€ì ", model: "Claude 3.5", input: 1300, output: 1200, cost: 0.08 },
                    { turn: 4, agent: "ê±°ì‹œê²½ì œ ì „ë¬¸ê°€", model: "Gemini 1.5", input: 1800, output: 1700, cost: 0.12 },
                    { turn: 5, agent: "ì¬ë¬´ ë¶„ì„ê°€", model: "GPT-4o", input: 2120, output: 1500, cost: 0.10 },
                ]
            }
        };

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            
            document.querySelectorAll('.sidebar-link').forEach(link => link.classList.remove('active'));
            document.querySelector(`.sidebar-link[onclick="showPage('${pageId}')"]`).classList.add('active');
        }

        function toggleModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                setTimeout(() => modal.classList.remove('opacity-0'), 10);
            } else {
                modal.classList.add('opacity-0');
                setTimeout(() => modal.classList.add('hidden'), 300);
            }
        }

        let costByAgentChartInstance;
        function showDetailPage(sessionId) {
            const data = detailData[sessionId] || detailData["sess_abc123"]; // Fallback for demo

            // Populate summary
            document.getElementById('detail-session-id').textContent = sessionId;
            document.getElementById('detail-topic').textContent = `ì£¼ì œ: ${data.topic}`;
            document.getElementById('detail-total-cost').textContent = `$${data.total_cost.toFixed(2)}`;
            document.getElementById('detail-total-tokens').textContent = data.total_tokens.toLocaleString();
            document.getElementById('detail-user').textContent = data.user;
            document.getElementById('detail-duration').textContent = data.duration;

            // Populate turn-by-turn table
            const tableBody = document.getElementById('detail-turn-table');
            tableBody.innerHTML = '';
            data.turns.forEach(turn => {
                const row = `
                    <tr>
                        <td>${turn.turn}</td>
                        <td>${turn.agent}</td>
                        <td><span class="bg-gray-100 text-gray-800 text-xs font-medium px-2 py-0.5 rounded">${turn.model}</span></td>
                        <td>${turn.input.toLocaleString()}</td>
                        <td>${turn.output.toLocaleString()}</td>
                        <td>$${turn.cost.toFixed(3)}</td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });

            // Aggregate data for chart
            const agentCosts = data.turns.reduce((acc, turn) => {
                acc[turn.agent] = (acc[turn.agent] || 0) + turn.cost;
                return acc;
            }, {});

            const chartLabels = Object.keys(agentCosts);
            const chartData = Object.values(agentCosts);

            // Create or update agent cost chart
            const ctxCostAgent = document.getElementById('costByAgentChart').getContext('2d');
            if (costByAgentChartInstance) {
                costByAgentChartInstance.destroy();
            }
            costByAgentChartInstance = new Chart(ctxCostAgent, {
                type: 'doughnut',
                data: {
                    labels: chartLabels,
                    datasets: [{
                        label: 'ë¹„ìš© ê¸°ì—¬ë„ ($)',
                        data: chartData,
                        backgroundColor: ['#2563eb', '#34d399', '#f59e0b', '#ef4444', '#8b5cf6']
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });

            showPage('token-detail');
        }


        document.addEventListener('DOMContentLoaded', () => {
            
            showPage('agents'); // Default page

            // Chart instances
            let weeklyChart, costModelChart, dailyCostChart;

            // Weekly Discussions Chart
            const ctxWeekly = document.getElementById('weeklyDiscussionsChart')?.getContext('2d');
            if(ctxWeekly) {
                weeklyChart = new Chart(ctxWeekly, {
                    type: 'line',
                    data: {
                        labels: ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'],
                        datasets: [{
                            label: 'í† ë¡  ìˆ˜',
                            data: [12, 19, 25, 28, 32, 22, 18],
                            borderColor: '#2563eb',
                            backgroundColor: 'rgba(37, 99, 235, 0.1)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            }

            // Cost by Model Chart
            const ctxCostModel = document.getElementById('costByModelChart')?.getContext('2d');
            if(ctxCostModel) {
                costModelChart = new Chart(ctxCostModel, {
                    type: 'pie',
                    data: {
                        labels: ['GPT-4o', 'Gemini 1.5 Pro', 'Claude 3.5 Sonnet'],
                        datasets: [{
                            label: 'ë¹„ìš© ($)',
                            data: [95.40, 55.20, 31.90],
                            backgroundColor: ['#2563eb', '#34d399', '#f59e0b']
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            }

            // Daily Cost Chart
            const ctxDailyCost = document.getElementById('dailyCostChart')?.getContext('2d');
            if(ctxDailyCost) {
                dailyCostChart = new Chart(ctxDailyCost, {
                    type: 'bar',
                    data: {
                        labels: ['8/12', '8/13', '8/14', '8/15', '8/16', '8/17', '8/18'],
                        datasets: [{
                            label: 'ì¼ë³„ ë¹„ìš© ($)',
                            data: [15.2, 22.5, 28.1, 30.5, 35.8, 25.4, 25.0],
                            backgroundColor: '#60a5fa'
                        }]
                    },
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: false,
                    }
                });
            }
        });
    </script>
</body>
</html>
